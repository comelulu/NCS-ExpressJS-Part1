# 30. ë‹¤ì–‘í•œ ì‘ë‹µ ë°©ë²• ì´ì •ë¦¬ â€“ `send`, `json`, `status` ë“±

---

## ğŸ§  Expressì—ì„œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‘ë‹µí•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•

Expressì—ì„œëŠ” ì‚¬ìš©ìì˜ ìš”ì²­ì— ëŒ€í•´ ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ ì‘ë‹µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ìš°ë¦¬ê°€ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ê²ƒì€ ë‹¨ìˆœí•œ ë¬¸ìì—´ë¶€í„° JSON, íŒŒì¼, ìƒíƒœ ì½”ë“œ, ë·° ë Œë”ë§ ë“± ì•„ì£¼ ë‹¤ì–‘í•©ë‹ˆë‹¤.

---

## ğŸ“¦ ì‹¤ìŠµ í´ë” êµ¬ì¡° (ì˜ˆì‹œ)

```
ğŸ“¦ express-response-summary
 â”£ ğŸ“„ index.js           â† ë‹¤ì–‘í•œ ì‘ë‹µ ì˜ˆì œë¥¼ ë‹´ì€ ë©”ì¸ íŒŒì¼
 â”£ ğŸ“„ sendFile.js        â† íŒŒì¼ì„ ë¸Œë¼ìš°ì €ì— ì§ì ‘ ë³´ì—¬ì£¼ëŠ” ì˜ˆì œ
 â”£ ğŸ“„ download.js        â† íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ë„ë¡ ì‘ë‹µí•˜ëŠ” ì˜ˆì œ
 â”£ ğŸ“‚views
 â”ƒ â”£ ğŸ“„ index.ejs        â† sendFile ì˜ˆì œì— ì‚¬ìš©ë  EJS í…œí”Œë¦¿
 â”ƒ â”— ğŸ“„ download.ejs     â† ë‹¤ìš´ë¡œë“œ í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” í…œí”Œë¦¿
 â”£ ğŸ“‚public
 â”ƒ â”— ğŸ“„ hello.png        â† ì „ì†¡í•  ì´ë¯¸ì§€ íŒŒì¼
```

---

## 1ï¸âƒ£ ğŸ“„ index.js â€“ ë‹¤ì–‘í•œ ì‘ë‹µ ë©”ì„œë“œ ì‹¤ìŠµ ì˜ˆì œ

```js
// ë‚´ì¥ ëª¨ë“ˆ 'path'ëŠ” íŒŒì¼ ê²½ë¡œë¥¼ ì•ˆì „í•˜ê²Œ ì¡°ì‘í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤ë‹ˆë‹¤.
const path = require("path");

// Express ì„œë²„ í”„ë ˆì„ì›Œí¬ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
const express = require("express");

// Express ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.
const app = express();

/* -------------------------------------------------------------------
  1. res.send()
     - ë¬¸ìì—´, HTML, JSON ê°ì²´ ë“± ë‹¤ì–‘í•œ ë°ì´í„°ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ë²”ìš© ë©”ì„œë“œì…ë‹ˆë‹¤.
     - ìë™ìœ¼ë¡œ Content-Typeì„ ì„¤ì •í•©ë‹ˆë‹¤.
------------------------------------------------------------------- */
app.get("/send", (req, res) => {
  res.send("Hello World"); // ë¬¸ìì—´ ì‘ë‹µ (Content-Type: text/html)
  // res.send("<h1>Hello World</h1>"); // HTML í˜•ì‹ë„ ê°€ëŠ¥
  // res.send({ name: "hello", age: 15 }); // ê°ì²´ â†’ JSONìœ¼ë¡œ ìë™ ë³€í™˜ë¨
});

/* -------------------------------------------------------------------
  2. res.json()
     - JSON í˜•ì‹ìœ¼ë¡œ ëª…í™•í•˜ê²Œ ì‘ë‹µì„ ë³´ë‚¼ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
     - res.send()ë³´ë‹¤ ì˜ë„ë¥¼ ë¶„ëª…íˆ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
     - ìë™ìœ¼ë¡œ Content-Type: application/jsonì„ ì„¤ì •í•©ë‹ˆë‹¤.
------------------------------------------------------------------- */
app.get("/json", (req, res) => {
  res.json({ name: "hello", age: 15 }); // JSON ì‘ë‹µ
});

/* -------------------------------------------------------------------
  3. res.status()
     - HTTP ìƒíƒœ ì½”ë“œë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
     - ë³´í†µ res.send(), res.json()ê³¼ í•¨ê»˜ ì‚¬ìš©ë©ë‹ˆë‹¤.
------------------------------------------------------------------- */
app.get("/unauthorized", (req, res) => {
  res.status(401).send("ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."); // 401 Unauthorized ì‘ë‹µ
});

app.get("/not-found", (req, res) => {
  res.status(404).json({ error: "í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }); // 404 Not Found
});

/* -------------------------------------------------------------------
  4. res.redirect()
     - í´ë¼ì´ì–¸íŠ¸ë¥¼ ë‹¤ë¥¸ ê²½ë¡œë¡œ ê°•ì œë¡œ ì´ë™ì‹œí‚¬ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
     - 301(ì˜êµ¬ ì´ë™), 302(ì„ì‹œ ì´ë™) ë“±ì˜ ìƒíƒœ ì½”ë“œë¥¼ í•¨ê»˜ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
------------------------------------------------------------------- */
app.get("/old-page", (req, res) => {
  res.redirect(301, "/new-page"); // /old-page ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ /new-pageë¡œ ì˜êµ¬ ë¦¬ë‹¤ì´ë ‰íŠ¸
});

app.get("/new-page", (req, res) => {
  res.send("ì´ í˜ì´ì§€ëŠ” ìƒˆë¡œìš´ ì£¼ì†Œì…ë‹ˆë‹¤."); // ë¦¬ë‹¤ì´ë ‰íŠ¸ëœ í˜ì´ì§€ì˜ ì‘ë‹µ
});

/* -------------------------------------------------------------------
  5. res.render()
     - EJS ê°™ì€ í…œí”Œë¦¿ ì—”ì§„ì„ í†µí•´ HTMLì„ ì„œë²„ì—ì„œ ë™ì ìœ¼ë¡œ ë Œë”ë§í•©ë‹ˆë‹¤.
     - í…œí”Œë¦¿ì— ë°ì´í„°ë¥¼ ì£¼ì…í•  ìˆ˜ ìˆì–´ ë‹¤ì–‘í•œ í™”ë©´ ìƒì„±ì— ìœ ìš©í•©ë‹ˆë‹¤.
------------------------------------------------------------------- */

// í…œí”Œë¦¿ ì—”ì§„ì„ EJSë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
app.set("view engine", "ejs");

// ë·° íŒŒì¼ë“¤ì´ ìœ„ì¹˜í•œ í´ë” ê²½ë¡œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
app.set("views", path.join(__dirname, "views"));

// [GET] /home ìš”ì²­ â†’ index.ejsë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
app.get("/home", (req, res) => {
  res.render("index", { title: "Express ì‘ë‹µ ìš”ì•½ ì˜ˆì œ" }); // {title}ì€ EJSì—ì„œ ì‚¬ìš©í•  ë³€ìˆ˜
});

// ì„œë²„ë¥¼ 3000ë²ˆ í¬íŠ¸ì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤.
app.listen(3000, () => {
  console.log("app listening at http://localhost:3000");
});
```

---

## 2ï¸âƒ£ ğŸ“„ sendFile.js â€“ íŒŒì¼ ì§ì ‘ ë³´ì—¬ì£¼ê¸° (ë¸Œë¼ìš°ì €ì—ì„œ ë³´ê¸°)

```js
const express = require("express"); // Express ë¶ˆëŸ¬ì˜¤ê¸°
const path = require("path"); // ê²½ë¡œ ì¡°ì‘ì„ ìœ„í•œ path ëª¨ë“ˆ
const app = express(); // Express ì•± ìƒì„±

// 1. EJS ë·° ì—”ì§„ ì„¤ì •
app.set("view engine", "ejs"); // EJSë¥¼ í…œí”Œë¦¿ ì—”ì§„ìœ¼ë¡œ ì‚¬ìš©
app.set("views", path.join(__dirname, "views")); // ë·° íŒŒì¼ë“¤ì˜ ìœ„ì¹˜ ì§€ì •

// 2. ì •ì  íŒŒì¼ ì œê³µ ì„¤ì • (public í´ë”ì— ìˆëŠ” íŒŒì¼ì„ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥)
app.use(express.static("public"));

// 3. ë£¨íŠ¸ ê²½ë¡œ ìš”ì²­ ì²˜ë¦¬ â€“ index.ejs ë Œë”ë§
app.get("/", (req, res) => {
  res.render("index", { title: "EJS with sendFile" }); // ë·°ì— title ë³€ìˆ˜ ì „ë‹¬
});

// 4. /file ìš”ì²­ ì²˜ë¦¬ â€“ ì´ë¯¸ì§€ íŒŒì¼ì„ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì§ì ‘ ì „ì†¡
app.get("/file", (req, res) => {
  const filePath = path.join(__dirname, "public", "hello.png"); // íŒŒì¼ ê²½ë¡œ ì„¤ì •
  res.sendFile(filePath); // ì´ë¯¸ì§€ ì§ì ‘ ì‘ë‹µ
});
```

### âœ… `res.sendFile()`ì´ë€?

- íŒŒì¼ ê²½ë¡œë¥¼ ì „ë‹¬í•˜ë©´, í•´ë‹¹ íŒŒì¼ì´ ë¸Œë¼ìš°ì €ì— **ê·¸ëŒ€ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤.**
- ì´ë¯¸ì§€, PDF, HTML, ZIP ë“± ëª¨ë“  íŒŒì¼ ê°€ëŠ¥
- ì‚¬ìš©ìì˜ ë‹¤ìš´ë¡œë“œ ì—†ì´ **íŒŒì¼ì„ ì—´ëŒ**ë§Œ í•  ë•Œ ìœ ìš©

---

## 3ï¸âƒ£ ğŸ“„ download.js â€“ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‘ë‹µ

```js
const path = require("path"); // ê²½ë¡œ ì¡°ì‘ìš© ëª¨ë“ˆ
const express = require("express"); // Express ë¶ˆëŸ¬ì˜¤ê¸°
const app = express(); // Express ì•± ìƒì„±

// 1. EJS ë·° ì—”ì§„ ì„¤ì •
app.set("view engine", "ejs"); // EJS í…œí”Œë¦¿ ì‚¬ìš© ì„¤ì •
app.set("views", path.join(__dirname, "views")); // ë·° ë””ë ‰í† ë¦¬ ì„¤ì •

// 2. /download-page ìš”ì²­ â€“ ë‹¤ìš´ë¡œë“œ ë§í¬ê°€ í¬í•¨ëœ EJS í˜ì´ì§€ ë Œë”ë§
app.get("/download-page", (req, res) => {
  res.render("download"); // download.ejs í…œí”Œë¦¿ ë Œë”ë§
});

// 3. /download-file ìš”ì²­ â€“ ì´ë¯¸ì§€ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ í˜•ì‹ìœ¼ë¡œ ì „ì†¡
app.get("/download-file", (req, res) => {
  const filePath = path.join(__dirname, "public", "hello.png"); // ëŒ€ìƒ íŒŒì¼ ê²½ë¡œ
  res.download(filePath); // íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ í˜•íƒœë¡œ ì‘ë‹µ
});

// 4. ì„œë²„ ì‹¤í–‰
app.listen(3000, () => {
  console.log(`app listening at http://localhost:3000`);
});
```

### âœ… `res.download()`ì´ë€?

- ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €ì—ì„œ **íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì°½ì„ ë„ìš°ëŠ” ì‘ë‹µ**ì…ë‹ˆë‹¤.
- PDF, ì´ë¯¸ì§€, ZIP ë“± ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•œ ëª¨ë“  í˜•ì‹ ì‚¬ìš© ê°€ëŠ¥
- ë‚´ë¶€ì ìœ¼ë¡œëŠ” `Content-Disposition: attachment` í—¤ë”ê°€ ì„¤ì •ë¨

---

## 4ï¸âƒ£ ğŸ“„ views/index.ejs â€“ sendFile ì˜ˆì œì—ì„œ ì‚¬ìš©

```ejs
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title><%= title %></title> <!-- ì„œë²„ì—ì„œ ì „ë‹¬í•œ title ë³€ìˆ˜ ì‚¬ìš© -->
  </head>
  <body>
    <h1>Welcome to <%= title %>!</h1> <!-- ë™ì ìœ¼ë¡œ í˜ì´ì§€ íƒ€ì´í‹€ í‘œì‹œ -->
    <p><a href="/file">View hello.png</a></p> <!-- ì´ë¯¸ì§€ íŒŒì¼ ì—´ê¸° ë§í¬ -->
  </body>
</html>
```

---

## 5ï¸âƒ£ ğŸ“„ views/download.ejs â€“ ë‹¤ìš´ë¡œë“œ í˜ì´ì§€ ì˜ˆì œ

```ejs
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Download Example</title>
  </head>
  <body>
    <h1>Download your file</h1>
    <a href="/download-file">Download hello.png</a> <!-- íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë§í¬ -->
  </body>
</html>
```

---

## ğŸ§  ë§ˆë¬´ë¦¬ ì •ë¦¬

| ë©”ì„œë“œ           | ì„¤ëª…                                   | ì˜ˆì‹œ                                  |
| ---------------- | -------------------------------------- | ------------------------------------- |
| `res.send()`     | ë¬¸ìì—´, HTML, ê°ì²´ ë“± ë‹¤ì–‘í•œ ì‘ë‹µ ì „ì†¡ | `res.send("Hello")`                   |
| `res.json()`     | JSON ì‘ë‹µ ì „ì†¡                         | `res.json({ name: "hi" })`            |
| `res.status()`   | ìƒíƒœ ì½”ë“œ ì„¤ì •                         | `res.status(404).send("Not found")`   |
| `res.redirect()` | ë‹¤ë¥¸ ì£¼ì†Œë¡œ ì´ë™                       | `res.redirect(301, "/new")`           |
| `res.render()`   | EJS ë“± í…œí”Œë¦¿ ë Œë”ë§                   | `res.render("home", { title: "í™ˆ" })` |
| `res.sendFile()` | íŒŒì¼ì„ ë¸Œë¼ìš°ì €ì— ì§ì ‘ ë³´ì—¬ì¤Œ          | `res.sendFile("path")`                |
| `res.download()` | íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ë„ë¡ ì‘ë‹µ             | `res.download("path")`                |
