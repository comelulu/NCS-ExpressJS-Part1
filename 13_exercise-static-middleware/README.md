# 13. [Exercise] Express Static Middleware 

```js
// 1. Express 모듈 불러오기
//    Node.js에서 서버를 만들기 위한 웹 프레임워크
const express = require("express");

// 2. 앱 인스턴스 생성
//    라우터, 미들웨어, 서버 실행 등을 이 app 객체로 처리합니다.
const app = express();

/*
==========================================================
📦 실제 시나리오: "상품 처리 공장"
- 이 코드는 Express 미들웨어를 활용해 마치 물류센터처럼 요청 흐름을 구성했습니다.
- 각각의 미들웨어는 상품의 처리 단계를 나타냅니다.
- 사용자가 "/delivery" 경로로 요청을 보내면, 상품이 공장을 거쳐 고객에게 배송되는 과정을 흉내냅니다.
==========================================================
*/

// ✅ [1단계] 상품이 공장에 도착
app.use((req, res, next) => {
  console.log("[1단계]: 상품이 도착했습니다.");
  next(); // 다음 단계로 넘어갑니다
});

// ✅ [2단계] 입고 처리
app.use((req, res, next) => {
  console.log("[2단계]: 상품이 입고되었습니다.");
  next();
});

// ✅ [3단계] 재고 시스템 등록
app.use((req, res, next) => {
  console.log("[3단계]: 재고 관리를 시작했습니다.");
  next();
});

// ✅ [4단계] 주문 확인
app.use((req, res, next) => {
  console.log("[4단계]: 주문 처리되었습니다.");
  next();
});

// ✅ [5단계] 배송 준비 완료 → 이제 실제 배송 라우터로 이동합니다
app.use((req, res, next) => {
  console.log("[5단계]: 물류 배송이 시작되었습니다. 라우터로 이동합니다.");
  next();
});

// ✅ [최종 단계] 배송 시작 (라우터 핸들러)
//     클라이언트가 "/delivery" 경로로 요청할 때 실행됩니다.
app.get("/delivery", (req, res) => {
  console.log("🚚 물류 배송 시작"); // 콘솔에 최종 메시지 출력
  res.send("<h1>물류 배송 시작</h1>"); // 클라이언트에게 HTML 응답 전송
});

// ✅ 3000번 포트에서 서버 실행
app.listen(3000, () => {
  console.log("✅ 서버가 3000번 포트에서 실행 중입니다.");
});
```

---

### 🧭 전체 요청 흐름 시각화

사용자가 브라우저에서 `http://localhost:3000/delivery`에 접속하면 서버에서 아래와 같이 단계별로 미들웨어가 실행됩니다:

```js
💻 클라이언트 요청 → GET /delivery

┌─────────────────────────────────────────────┐
│  [1단계] 상품이 도착했습니다.                   │
└────────────┬────────────────────────────────┘
             ▼
┌─────────────────────────────────────────────┐
│  [2단계] 상품이 입고되었습니다.                 │
└────────────┬────────────────────────────────┘
             ▼
┌─────────────────────────────────────────────┐
│  [3단계] 재고 관리를 시작했습니다.              │
└────────────┬────────────────────────────────┘
             ▼
┌─────────────────────────────────────────────┐
│  [4단계] 주문 처리되었습니다.                   │
└────────────┬────────────────────────────────┘
             ▼
┌─────────────────────────────────────────────┐
│  [5단계] 물류 배송이 시작되었습니다.             │
│           라우터로 이동합니다.                 │
└────────────┬────────────────────────────────┘
             ▼
┌─────────────────────────────────────────────┐
│  [라우터] GET /delivery                      │
│  → console.log("🚚 물류 배송 시작")           │
│  → res.send("<h1>물류 배송 시작</h1>")        │
└─────────────────────────────────────────────┘
```

---

### 💡 미들웨어의 실무적인 비유

| 미들웨어 단계 | 현실 세계 비유 |
|------------------|-------------------|
| 1단계 | 물류 센터에 트럭이 도착 |
| 2단계 | 상품이 창고에 정식으로 입고 |
| 3단계 | 바코드 찍고 재고 시스템에 등록 |
| 4단계 | 고객 주문 확인 및 처리 완료 |
| 5단계 | 상품 포장 후 택배로 넘김 |
| 라우터 | 최종 배송 트럭 출발, 고객에게 전달 |

---

### 📌 미들웨어 흐름 정리

| 구분 | 기능 | 실행 조건 |
|------|------|-----------|
| `app.use()` | 모든 요청에 대해 실행 | 순서대로 실행됨 |
| `next()` | 다음 미들웨어로 요청 전달 | 호출하지 않으면 중단됨 |
| `app.get("/delivery")` | 특정 경로의 최종 응답 처리 | 이전 단계 모두 통과해야 도달함 |

---

### ✅ 확장 팁

- `app.use("/delivery", middleware)`처럼 특정 경로에만 미들웨어 적용 가능
- 미들웨어에서 조건 분기하거나, 사용자 인증 처리도 가능
- `express.static("products")`처럼 실제 상품 이미지를 제공하는 정적 폴더도 함께 구성 가능

