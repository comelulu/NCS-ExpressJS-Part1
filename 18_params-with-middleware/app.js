const express = require("express");
const app = express();

/*
==========================================================
ðŸ§© app.param("userId", callback)
----------------------------------------------------------
- ë¼ìš°íŠ¸ ê²½ë¡œì— :userIdê°€ ì‚¬ìš©ë  ë•Œë§ˆë‹¤ ì´ ë¯¸ë“¤ì›¨ì–´ê°€ ìžë™ ì‹¤í–‰ë©ë‹ˆë‹¤.
- ì£¼ë¡œ DBì—ì„œ ì‚¬ìš©ìž ì •ë³´ë¥¼ ë¯¸ë¦¬ ì¡°íšŒí•˜ê±°ë‚˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
*/
app.param("userId", (req, res, next, id) => {
  // "userId"ëŠ” ê²½ë¡œ íŒŒë¼ë¯¸í„° (:userId)ì˜ ì‹¤ì œ ê°’
  const user = getUserById(id); // ê°€ìƒì˜ DB ì¡°íšŒ í•¨ìˆ˜

  // ì‚¬ìš©ìžê°€ ì¡´ìž¬í•˜ì§€ ì•Šìœ¼ë©´ 404 ì—ëŸ¬ ì‘ë‹µ
  if (!user) {
    return res.status(404).send("User not found");
  }

  // req.userì— ì‚¬ìš©ìž ì •ë³´ë¥¼ ì €ìž¥í•˜ì—¬ ì´í›„ ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš©
  req.user = user;

  next(); // ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ ë˜ëŠ” ë¼ìš°í„°ë¡œ ì§„í–‰
});

/*
==========================================================
ðŸ“„ GET /users/:userId
----------------------------------------------------------
- :userIdê°€ URLì— í¬í•¨ë˜ì–´ ìžˆìœ¼ë¯€ë¡œ, ìœ„ì˜ app.paramì´ ìžë™ ì‹¤í–‰ë©ë‹ˆë‹¤.
- req.userì—ëŠ” ì‚¬ìš©ìž ì •ë³´ê°€ ì´ë¯¸ ë“¤ì–´ìžˆëŠ” ìƒíƒœìž…ë‹ˆë‹¤.
*/
app.get("/users/:userId", (req, res) => {
  res.send(req.user); // ì‚¬ìš©ìž ì •ë³´ ì‘ë‹µ
});

/*
==========================================================
ðŸ“„ GET /blogs/:userId
----------------------------------------------------------
- ë‹¤ë¥¸ ê²½ë¡œì—ì„œë„ :userIdê°€ í¬í•¨ë˜ì–´ ìžˆìœ¼ë©´ app.paramì´ ë™ì¼í•˜ê²Œ ì‹¤í–‰ë©ë‹ˆë‹¤.
- ì¦‰, ì¤‘ë³µ ì—†ì´ ì‚¬ìš©ìž ì „ì²˜ë¦¬ ë¡œì§ì„ ìž¬ì‚¬ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
*/
app.get("/blogs/:userId", (req, res) => {
  res.send({
    message: `${req.user.name}ë‹˜ì˜ ë¸”ë¡œê·¸ìž…ë‹ˆë‹¤.`,
    user: req.user,
  });
});

/*
==========================================================
ðŸ“¦ ê°€ìƒì˜ ë°ì´í„° ì¡°íšŒ í•¨ìˆ˜ (ì‹¤ì œ DB ëŒ€ì‹  í•˜ë“œì½”ë”©)
*/
function getUserById(id) {
  const users = {
    1: { id: 1, name: "Alice", role: "Admin" },
    2: { id: 2, name: "Bob", role: "User" },
  };
  return users[id];
}

// âœ… ì„œë²„ ì‹¤í–‰
const PORT = 3000;
app.listen(PORT, () => console.log(`âœ… Server running on port ${PORT}`));
