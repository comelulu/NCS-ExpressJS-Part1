# 14. Custom Middleware: Req <==> Res

## π§Ύ μ „μ²΄ μ½”λ“ (μ„¤λ… ν¬ν•¨)

```js
// 1. Express λ¨λ“ λ¶λ¬μ¤κΈ°
const express = require("express");
const app = express();

/*
==========================================================
π›΅οΈ [1λ‹¨κ³„] μ‚¬μ©μ μΈμ¦ λ―Έλ“¤μ›¨μ–΄
==========================================================
- μ΄ λ―Έλ“¤μ›¨μ–΄λ” μ”μ²­μ΄ λ“¤μ–΄μ¬ λ•λ§λ‹¤ μ‚¬μ©μ μ •λ³΄λ¥Ό μΈμ¦λ κ²ƒμ²λΌ μ„¤μ •ν•΄μ£Όλ” μ—­ν• μ„ ν•©λ‹λ‹¤.
- μ‹¤μ  μ„λΉ„μ¤μ—μ„λ” μ—¬κΈ°μ— JWT ν† ν° κ²€μ¦, μ„Έμ… κ²€μ‚¬ λ“± λ΅μ§μ΄ λ“¤μ–΄κ°‘λ‹λ‹¤.
- μ—¬κΈ°μ„λ” μμ‹λ΅, λ¨λ“  μ”μ²­μ— λ€ν•΄ `req.user` κ°μ²΄λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤.
*/
app.use((req, res, next) => {
  // μΈμ¦μ΄ μ™„λ£λμ—λ‹¤κ³  κ°€μ •ν•κ³  μ‚¬μ©μ μ •λ³΄ μ£Όμ…
  req.user = { id: "123", name: "John Doe", role: "Admin" };
  next(); // λ‹¤μ λ―Έλ“¤μ›¨μ–΄λ΅ λ„μ–΄κ°
});

/*
==========================================================
π“¦ [2λ‹¨κ³„] μ»¤μ¤ν…€ μ‘λ‹µ λ©”μ„λ“ λ―Έλ“¤μ›¨μ–΄
==========================================================
- μ‘λ‹µ κ°μ²΄(res)μ— μƒλ΅μ΄ λ©”μ„λ“(res.success, res.error)λ¥Ό μ¶”κ°€ν•©λ‹λ‹¤.
- μ΄ λ©”μ„λ“λ¥Ό ν†µν•΄ JSON ν•μ‹μ μΌκ΄€λ μ‘λ‹µμ„ μ‰½κ² λ³΄λ‚Ό μ μμµλ‹λ‹¤.
*/
app.use((req, res, next) => {
  // μ„±κ³µ μ‘λ‹µμ© λ©”μ„λ“ μ •μ
  res.success = (data) => {
    res.status(200).json({ status: "success", data: data });
  };

  // μ—λ¬ μ‘λ‹µμ© λ©”μ„λ“ μ •μ
  res.error = (message) => {
    res.status(400).json({ status: "error", message: message });
  };

  next(); // λ‹¤μ λ―Έλ“¤μ›¨μ–΄ λλ” λΌμ°ν„°λ΅ μ΄λ™
});

/*
==========================================================
π“„ [λΌμ°νΈ 1] /profile
- μ‚¬μ©μ μ •λ³΄λ¥Ό μ‘λ‹µμΌλ΅ λ³΄λ‚΄λ” λΌμ°νΈμ…λ‹λ‹¤.
- μ²« λ²μ§Έ λ―Έλ“¤μ›¨μ–΄μ—μ„ μ„¤μ •ν• `req.user`μ— μ ‘κ·Όν•©λ‹λ‹¤.
==========================================================
*/
app.get("/profile", (req, res) => {
  // μ‚¬μ©μ μ΄λ¦„κ³Ό μ—­ν• μ„ ν…μ¤νΈλ΅ μ‘λ‹µ
  res.send(`User Profile: ${req.user.name}, Role: ${req.user.role}`);
});

/*
==========================================================
β… [λΌμ°νΈ 2] /success
- μ»¤μ¤ν…€ μ„±κ³µ μ‘λ‹µ(res.success)μ„ ν…μ¤νΈν•©λ‹λ‹¤.
==========================================================
*/
app.get("/success", (req, res) => {
  res.success({ message: "This is a successful response!" });
});

/*
==========================================================
β [λΌμ°νΈ 3] /error
- μ»¤μ¤ν…€ μ—λ¬ μ‘λ‹µ(res.error)μ„ ν…μ¤νΈν•©λ‹λ‹¤.
==========================================================
*/
app.get("/error", (req, res) => {
  res.error("This is an error response.");
});

/*
==========================================================
π€ [μ„λ²„ μ‹¤ν–‰]
==========================================================
- 3000λ² ν¬νΈμ—μ„ μ„λ²„λ¥Ό μ‹μ‘ν•©λ‹λ‹¤.
- http://localhost:3000 κ²½λ΅μ—μ„ λΌμ°νΈλ“¤μ„ ν…μ¤νΈν•  μ μμµλ‹λ‹¤.
*/
app.listen(3000, () => {
  console.log("β… μ„λ²„κ°€ 3000λ² ν¬νΈμ—μ„ μ‹¤ν–‰ μ¤‘μ…λ‹λ‹¤.");
});
```

---

## π§­ μ „μ²΄ μ”μ²­ νλ¦„ μ‹κ°ν™”

λΈλΌμ°μ € λλ” API ν΄λΌμ΄μ–ΈνΈ(Postman λ“±)λ΅ `http://localhost:3000/profile` μ”μ²­ μ‹:

```js
π’» ν΄λΌμ΄μ–ΈνΈ μ”μ²­ β†’ GET /profile

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ [1λ‹¨κ³„] μ‚¬μ©μ μΈμ¦ λ―Έλ“¤μ›¨μ–΄                   β”‚
β”‚ β†’ req.user = { id: "123", name: "John", ...β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ [2λ‹¨κ³„] μ»¤μ¤ν…€ μ‘λ‹µ λ©”μ„λ“ λ―Έλ“¤μ›¨μ–΄            β”‚
β”‚ β†’ res.success(), res.error() λ©”μ„λ“ μ¶”κ°€    β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ [λΌμ°νΈ] GET /profile                       β”‚
β”‚ β†’ req.user.name β†’ "John Doe"               β”‚
β”‚ β†’ res.send("User Profile: John Doe...")    β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## π“ μ”μ•½: μ£Όμ” κ°λ… μ •λ¦¬

| κ°λ…                 | μ„¤λ…                                                  |
| -------------------- | ----------------------------------------------------- |
| `req.user`           | μ‚¬μ©μ μΈμ¦ ν›„, μΈμ¦λ μ‚¬μ©μ μ •λ³΄λ¥Ό λ‹΄λ” κ³µκ°„        |
| `res.success(data)`  | μΌκ΄€λ ν•μ‹μ μ„±κ³µ μ‘λ‹µμ„ λ³΄λ‚΄λ” μ‚¬μ©μ μ •μ λ©”μ„λ“   |
| `res.error(message)` | μ—λ¬ λ©”μ‹μ§€λ¥Ό JSON ν•μ‹μΌλ΅ λ³΄λ‚΄λ” μ‚¬μ©μ μ •μ λ©”μ„λ“ |
| `app.use()`          | λ¨λ“  μ”μ²­μ— μ μ©λλ” κ³µν†µ λ―Έλ“¤μ›¨μ–΄ λ“±λ΅ μ‹ μ‚¬μ©       |
| `next()`             | λ‹¤μ λ―Έλ“¤μ›¨μ–΄ λλ” λΌμ°ν„°λ΅ μ”μ²­ νλ¦„ μ „λ‹¬            |

---

## π’΅ μ‹¤λ¬΄ ν™•μ¥ ν¬μΈνΈ

- `req.user`λ” λ³΄ν†µ **JWT ν† ν° ν•΄μ„ κ²°κ³Ό**, λλ” **μ„Έμ… μ •λ³΄**μ—μ„ μ¶”μ¶λ©λ‹λ‹¤.
- `res.success`, `res.error` κ°™μ€ μ»¤μ¤ν…€ μ‘λ‹µμ€ API κ°λ° μ‹ **μΌκ΄€λ μ‘λ‹µ ν¬λ§· μ μ§€**μ— λ§¤μ° μ μ©ν•©λ‹λ‹¤.
- μ΄ κµ¬μ΅°λ” μ‹¤μ λ΅ Express κΈ°λ° RESTful APIμ **κΈ°μ΄ μ„¤κ³„ ν¨ν„΄**μ— μμ£Ό μ‚¬μ©λ©λ‹λ‹¤.

---

## β… ν…μ¤νΈ μμ‹

| κ²½λ΅       | μ‘λ‹µ λ‚΄μ©                                               |
| ---------- | ------------------------------------------------------- |
| `/profile` | `User Profile: John Doe, Role: Admin`                   |
| `/success` | `{ "status": "success", "data": { "message": "..." } }` |
| `/error`   | `{ "status": "error", "message": "..." }`               |
