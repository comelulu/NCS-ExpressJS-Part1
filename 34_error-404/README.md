# 34. 🔐 404 에러 처리 – 없는 페이지에도 품격을

---

## 📦 404 에러란?

### 💡 **404 에러**는 사용자가 요청한 페이지를 **서버가 찾을 수 없는 경우**에 발생하는 에러입니다.  
**404 에러** 페이지는 **사용자에게 잘못된 URL**이나 **삭제된 페이지**에 접근했음을 알려주는 중요한 역할을 합니다. 이때, 단순히 **404 에러 메시지만 표시**하는 것이 아니라, **사용자가 사이트에서 더 나아갈 수 있는 안내**도 함께 제공하는 것이 중요합니다. 이를 통해 사용자에게 **친절하고 품격 있는 경험**을 제공할 수 있습니다.

---

## 🧠 404 에러 처리 이유

- **사용자 경험 향상**: **404 에러 페이지**에서 **친절한 안내**를 제공하여 사용자가 **어디로 가야 할지** 알 수 있게 합니다.
- **사이트 신뢰성 향상**: **404 페이지**를 잘 디자인하면, 사용자가 **사이트에 대해 신뢰**를 가질 수 있습니다.
- **사이트 내비게이션 유지**: **홈페이지로 돌아가기**, **최근 링크 제공** 등 **이탈하지 않도록 유도**합니다.

---

## 🔍 404 에러 처리 – 코드 설명

### **404 에러 페이지 디자인 (views/404.ejs)**

404 페이지는 **간단하고 직관적**이며 **사용자에게 명확한 메시지**를 제공하는 것이 중요합니다. 아래는 **404.ejs** 파일의 내용입니다.

```html
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>페이지를 찾을 수 없습니다</title>
  </head>
  <body>
    <h1>404: 페이지를 찾을 수 없습니다</h1>
    <p>죄송합니다만, 찾으려는 페이지가 존재하지 않습니다.</p>
    <p>다음과 같은 이유로 페이지를 찾을 수 없습니다:</p>
    <ul>
      <li>주소를 잘못 입력했습니다</li>
      <li>링크가 오래되었거나 사용할 수 없습니다</li>
    </ul>
    <p>접근하려고 시도한 주소: <strong><%= url %></strong></p>
    <p><a href="/">홈페이지로 돌아가기</a></p>
  </body>
</html>
```

#### **설명**:
- **`<h1>`**: 사용자가 페이지를 찾을 수 없다는 **주요 메시지**를 강조합니다.
- **`<ul>`**: 페이지를 찾을 수 없는 이유에 대해 **간단한 두 가지 설명**을 제공합니다.
- **`<strong><%= url %></strong>`**: 사용자에게 **잘못된 URL**을 정확하게 보여줍니다. 이 부분은 서버에서 **동적으로 값**이 들어가게 됩니다.
- **`<a href="/">홈페이지로 돌아가기</a>`**: 사용자가 **홈페이지로 돌아갈 수 있도록** 유도하는 링크를 제공합니다.

---

### **404 에러 처리 구현 (errorHandling400.js)**

이제 **Express**에서 **404 에러**를 처리하고, **404 페이지를 렌더링**하는 코드입니다.

```js
// path 모듈을 불러옵니다. (디렉토리 경로를 쉽게 관리하기 위해 사용)
const path = require("path");
// express 모듈을 불러옵니다. (웹 서버를 구축하기 위한 라이브러리)
const express = require("express");
// Express 애플리케이션 인스턴스를 생성합니다.
const app = express();

// 1. 뷰 엔진 설정 (EJS 사용)
// EJS는 서버에서 동적으로 HTML을 생성할 수 있는 템플릿 엔진입니다.
// 앱에서 사용할 뷰 엔진을 EJS로 설정합니다.
app.set("view engine", "ejs");

// 2. views 디렉토리 설정
// Express는 기본적으로 'views' 폴더를 템플릿 파일을 찾는 디렉토리로 사용합니다.
// path.join(__dirname, "views")는 현재 파일이 위치한 디렉토리에서 'views' 디렉토리로 경로를 설정합니다.
app.set("views", path.join(__dirname, "views"));

// 3. 기본 라우트 설정 (홈페이지)
// 사용자가 홈페이지로 요청을 보내면, 이 라우트가 응답을 처리합니다.
app.get("/", (req, res) => {
  // GET / 요청에 대해 'Homepage'라는 메시지를 클라이언트에 응답합니다.
  res.send("[GET /] Homepage");
});

// 4. 사용자 페이지 라우트 설정
// '/users' 경로로 요청이 오면 이 라우트가 실행됩니다.
app.get("/users", (req, res) => {
  // GET /users 요청에 대해 'Userpage'라는 메시지를 클라이언트에 응답합니다.
  res.send("[GET /users] Userpage");
});

// 5. 그 외의 모든 요청에 대해 404 페이지 처리
// 위에서 정의된 라우트 이외의 요청에 대해 404 오류 페이지를 보여줍니다.
// 모든 라우트는 이 미들웨어 이후에 정의되어야 합니다.
app.use((req, res, next) => {
  // '404.ejs' 파일을 렌더링하며, 요청된 URL을 `url` 변수로 전달합니다.
  // 이를 통해 잘못된 URL에 대한 정보도 사용자에게 제공할 수 있습니다.
  res.status(404).render("404", { url: req.url });
});

// 6. 서버 실행
// 3000번 포트에서 Express 서버를 실행합니다.
// 서버가 실행되면 콘솔에 "Listening on port 3000"이 출력됩니다.
app.listen(3000, () => {
  console.log("Listening on port 3000");
});

```

#### **설명**:
1. **뷰 엔진 설정**:
   - `app.set("view engine", "ejs")`는 **EJS**를 템플릿 엔진으로 사용한다고 Express에 알려줍니다. 이 설정을 통해 동적으로 HTML 페이지를 생성할 수 있게 됩니다.
   - **EJS**는 서버에서 데이터를 동적으로 HTML 페이지에 삽입할 수 있도록 도와주는 템플릿 엔진입니다.

2. **뷰 디렉토리 설정**:
   - `app.set("views", path.join(__dirname, "views"))`는 **EJS** 템플릿 파일이 위치한 디렉토리 경로를 설정합니다. `__dirname`은 현재 파일의 디렉토리를 가리키며, `path.join()`을 사용하여 `'views'` 디렉토리로 정확한 경로를 설정합니다.

3. **기본 라우트 설정**:
   - `app.get("/", (req, res) => {...})`는 **홈페이지**를 위한 기본 라우트를 정의합니다. 사용자가 `/` 경로로 요청을 보내면 **"Homepage"**라는 텍스트를 응답으로 보냅니다.
   - 이 라우트는 **웹 사이트의 첫 페이지** 역할을 하며, **GET 방식**으로 요청을 처리합니다.

4. **사용자 페이지 라우트 설정**:
   - `app.get("/users", (req, res) => {...})`는 `/users` 경로로 요청을 받으면 **"Userpage"**라는 메시지를 클라이언트에 반환합니다.
   - 이 라우트는 **사용자 관련 페이지**로의 요청을 처리합니다.

5. **404 페이지 처리 미들웨어**:
   - `app.use((req, res, next) => {...})`는 **404 에러 처리 미들웨어**로, 정의된 다른 라우트에 해당하지 않는 모든 요청에 대해 **404 페이지**를 반환합니다.
   - `res.status(404).render("404", { url: req.url })`는 `404.ejs` 파일을 렌더링하며, 잘못된 URL 정보를 동적으로 전달하여 사용자에게 **어떤 페이지를 찾을 수 없었는지** 알립니다.
   
6. **서버 실행**:
   - `app.listen(3000, () => {...})`는 **Express 서버**를 **3000번 포트**에서 실행시킵니다. 서버가 성공적으로 실행되면, 콘솔에 `"Listening on port 3000"` 메시지가 출력됩니다.
   - **3000번 포트**는 서버가 클라이언트 요청을 받을 때 사용하는 포트 번호입니다.

---

## 📊 404 에러 처리 흐름 요약 시각화

```js
🧍 사용자: /wrong-page 요청 → 잘못된 페이지
──────────────────────────────────────
↓
📦 서버:
  - 404 에러 발생
  - 404 페이지 렌더링 (404.ejs)
  - 잘못된 URL과 안내 메시지 제공

🧍 사용자: 404 페이지에서 홈페이지로 돌아가기
──────────────────────────────────────
↓
📦 서버:
  - 사용자 홈페이지로 리디렉션
```

---

## 🧪 실제 요청 확인 (브라우저 개발자 도구)

```http
GET /nonexistent-page HTTP/1.1
Host: localhost:3000
```

> 브라우저에서 **존재하지 않는 페이지**에 접근하면, **404 페이지**가 반환되며, 잘못된 URL과 함께 사용자에게 친절한 안내가 제공됩니다.

---

## 🔐 보안 팁 – 404 에러 페이지 안전하게 구현하기

| 설정 | 설명 | 추천 여부 |
|------|------|-----------|
| **사용자 친화적 메시지** | 404 페이지에서 **친절한 안내**를 제공하여 사용자가 어디로 가야 할지 알 수 있게 합니다. | ✅ 필수 |
| **`url` 정보 제공** | 잘못된 URL을 사용자에게 명확히 알려주어, 어떤 페이지를 찾으려고 했는지 확인할 수 있도록 합니다. | ✅ 필수 |
| **홈페이지 링크 제공** | 사용자가 404 에러 페이지에서 **홈페이지로 돌아갈 수 있는 링크**를 제공하여, 이탈을 막습니다. | ✅ 필수 |

---

## ✅ Express에서 404 에러 처리 메서드 정리

| 메서드 | 설명 | 예시 |
|--------|------|------|
| **`res.status(404).render()`** | 404 에러 페이지를 렌더링하여 사용자에게 잘못된 페이지 접근을 알려줍니다. | `res.status(404).render("404", { url: req.url })` |

---

## 🔚 마무리 요약

| 개념 | 설명 |
|------|------|
| 404 에러 페이지 | 사용자가 **잘못된 URL**에 접근했을 때, **친절한 메시지와 안내**를 제공하여 사이트 이탈을 방지합니다. |
| Express 구현 | Express에서 **`app.use()`**를 사용해 404 에러를 처리하고, EJS로 사용자에게 동적으로 에러 페이지를 전달합니다. |
| 404 페이지 디자인 | **사용자가 요청한 잘못된 URL**을 표시하고, **홈페이지로 돌아가기** 링크를 제공합니다. |
