# 12. Express Middleware Intro

```js
// 1. Express λ¨λ“μ„ λ¶λ¬μµλ‹λ‹¤.
//    Expressλ” Node.jsμ—μ„ μ›Ή μ„λ²„λ¥Ό μ‰½κ³  λΉ λ¥΄κ² λ§λ“¤ μ μλ„λ΅ λ„μ™€μ£Όλ” ν”„λ μ„μ›ν¬μ…λ‹λ‹¤.
const express = require("express");

// 2. express() ν•¨μλ¥Ό νΈμ¶ν•μ—¬ μ• ν”λ¦¬μΌ€μ΄μ… μΈμ¤ν„΄μ¤λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
//    μ΄ 'app' κ°μ²΄λ¥Ό μ‚¬μ©ν•΄ λΌμ°ν…, λ―Έλ“¤μ›¨μ–΄ μ„¤μ •, μ„λ²„ μ‹¤ν–‰ λ“±μ„ μ²λ¦¬ν•©λ‹λ‹¤.
const app = express();

/*
--------------------------------------------------------
π”Ή [λ―Έλ“¤μ›¨μ–΄λ€?]
- λ―Έλ“¤μ›¨μ–΄(Middleware)λ” 'μ”μ²­(Request)'κ³Ό 'μ‘λ‹µ(Response)' μ‚¬μ΄μ—μ„ μ‹¤ν–‰λλ” ν•¨μμ…λ‹λ‹¤.
- ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μ”μ²­μ΄ λ“¤μ–΄μ¤λ©΄, Expressλ” λ“±λ΅λ λ―Έλ“¤μ›¨μ–΄λ“¤μ„ 'μμ„λ€λ΅' μ‹¤ν–‰ν•©λ‹λ‹¤.
- κ° λ―Έλ“¤μ›¨μ–΄λ” μ”μ²­(req), μ‘λ‹µ(res), κ·Έλ¦¬κ³  'λ‹¤μ λ―Έλ“¤μ›¨μ–΄λ¥Ό νΈμ¶ν•λ” next() ν•¨μ'λ¥Ό μΈμλ΅ λ°›μµλ‹λ‹¤.

π”Ή [app.use()]
- μ΄ λ©”μ„λ“λ” κ²½λ΅ μ§€μ • μ—†μ΄ λ¨λ“  μ”μ²­μ— λ€ν•΄ λ―Έλ“¤μ›¨μ–΄λ¥Ό μ μ©ν•©λ‹λ‹¤.
- μ¦‰, μ–΄λ–¤ κ²½λ΅λ΅ μ–΄λ–¤ λ©”μ„λ“(GET, POST λ“±)λ΅ μ”μ²­μ΄ μ¤λ”λΌλ„ μ‹¤ν–‰λ©λ‹λ‹¤.
--------------------------------------------------------
*/

// β… μ²« λ²μ§Έ λ―Έλ“¤μ›¨μ–΄
app.use((req, res, next) => {
  // μ΄ λ―Έλ“¤μ›¨μ–΄λ” λ¨λ“  μ”μ²­μ΄ λ“¤μ–΄μ¬ λ• κ°€μ¥ λ¨Όμ € μ‹¤ν–‰λ©λ‹λ‹¤.
  // μ½μ†” λ΅κ·Έλ¥Ό ν†µν•΄ μ”μ²­ νλ¦„μ„ μ¶”μ ν•  μ μμµλ‹λ‹¤.
  console.log("μ²« λ²μ§Έ λ―Έλ“¤μ›¨μ–΄");

  // next() ν•¨μλ¥Ό νΈμ¶ν•λ©΄ μ”μ²­μ΄ λ‹¤μ λ―Έλ“¤μ›¨μ–΄λ΅ μ „λ‹¬λ©λ‹λ‹¤.
  // νΈμ¶ν•μ§€ μ•μΌλ©΄ μ”μ²­ μ²λ¦¬κ°€ μ—¬κΈ°μ„ λ©μ¶°μ„ μ‘λ‹µμ΄ ν΄λΌμ΄μ–ΈνΈμ—κ² κ°€μ§€ μ•μµλ‹λ‹¤.
  next();
});

// β… λ‘ λ²μ§Έ λ―Έλ“¤μ›¨μ–΄
app.use((req, res, next) => {
  // μ²« λ²μ§Έ λ―Έλ“¤μ›¨μ–΄μ—μ„ next()κ°€ νΈμ¶λμ—κΈ° λ•λ¬Έμ—, μ΄ λ―Έλ“¤μ›¨μ–΄κ°€ μ‹¤ν–‰λ©λ‹λ‹¤.
  console.log("λ‘ λ²μ§Έ λ―Έλ“¤μ›¨μ–΄");

  // μ—¬κΈ°μ„ μ‘λ‹µμ„ λ³΄λ‚΄κ³  μ”μ²­ μ²λ¦¬λ¥Ό μΆ…λ£ν•©λ‹λ‹¤.
  // res.send()λ” ν΄λΌμ΄μ–ΈνΈμ—κ² μ‘λ‹µμ„ λ³΄λ‚΄λ” λ©”μ„λ“μ…λ‹λ‹¤.
  res.send("μ‘λ‹µ μ™„λ£");

  /*
  β… μ£Όμ:
  - res.send()κ°€ μ‹¤ν–‰λλ©΄ λ” μ΄μƒ λ‹¤λ¥Έ λ―Έλ“¤μ›¨μ–΄λ‚ λΌμ°ν„°λ” μ‹¤ν–‰λμ§€ μ•μµλ‹λ‹¤.
  - μ¦‰, μ΄ μ‹μ μ—μ„ μ”μ²­-μ‘λ‹µ μ‚¬μ΄ν΄μ΄ 'μΆ…λ£'λ©λ‹λ‹¤.
  */
});

// β… νΉμ • λΌμ°ν… ν•Έλ“¤λ¬ (μ‹¤μ λ΅λ” μ‹¤ν–‰λμ§€ μ•μ)
app.get("/", (req, res) => {
  // μ΄ λΌμ°νΈ ν•Έλ“¤λ¬λ” λΈλΌμ°μ €μ—μ„ '/' κ²½λ΅λ΅ GET μ”μ²­μ΄ λ“¤μ–΄μ™”μ„ λ• μ‹¤ν–‰λ©λ‹λ‹¤.
  // ν•μ§€λ§ μ„μ—μ„ μ‘λ‹µμ΄ μ΄λ―Έ λλ‚¬κΈ° λ•λ¬Έμ— μ΄ μ½”λ“λ” μ‹¤ν–‰λμ§€ μ•μµλ‹λ‹¤.
  res.send("<h1>Homepage</h1>");
});

/*
--------------------------------------------------------
π”Ή [μ”μ²­ μ²λ¦¬ νλ¦„ μ”μ•½]

ν΄λΌμ΄μ–ΈνΈ μ”μ²­ νλ¦„ μ‹κ°ν™”:

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  ν΄λΌμ΄μ–ΈνΈ μ”μ²­ λ°μƒ      β”‚  β† λΈλΌμ°μ €: http://localhost:3000/
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β”‚
             β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ μ²« λ²μ§Έ λ―Έλ“¤μ›¨μ–΄ μ‹¤ν–‰         β”‚
β”‚ console.log("μ²« λ²μ§Έ")      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β”‚ next()
             β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ λ‘ λ²μ§Έ λ―Έλ“¤μ›¨μ–΄ μ‹¤ν–‰         β”‚
β”‚ console.log("λ‘ λ²μ§Έ")      β”‚
β”‚ res.send("μ‘λ‹µ μ™„λ£")      β”‚ β† μ—¬κΈ°μ„ μ‘λ‹µμ΄ λλ‚©λ‹λ‹¤!
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
             β”‚
             β””β”€β”€[μΆ…λ£] λΌμ°ν„° μ‹¤ν–‰ μ• λ¨

β€» app.get("/") λΌμ°ν„°λ” μ‹¤ν–‰λμ§€ μ•μ
--------------------------------------------------------
*/

// β… μ„λ²„ μ‹¤ν–‰
//    μ„λ²„λ¥Ό 3000λ² ν¬νΈμ—μ„ μ‹¤ν–‰ν•κ³ , μ”μ²­μ„ κΈ°λ‹¤λ¦½λ‹λ‹¤.
app.listen(3000, () => {
  console.log("β… μ„λ²„κ°€ 3000λ² ν¬νΈμ—μ„ μ‹¤ν–‰ μ¤‘μ…λ‹λ‹¤.");
});
```

---

### π“ μ©μ–΄ ν• λ² λ” μ”μ•½ (μ¤‘μ”ν• ν¬μΈνΈ μ •λ¦¬)

| μ©μ–΄        | μ„¤λ… |
|-------------|------|
| `app.use()` | λ¨λ“  μ”μ²­μ— λ€ν•΄ λ―Έλ“¤μ›¨μ–΄λ¥Ό μ‹¤ν–‰ν•λ” λ©”μ„λ“ |
| `req`       | μ”μ²­ κ°μ²΄. ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ μ •λ³΄ (URL, ν—¤λ” λ“±)λ¥Ό λ‹΄κ³  μμ |
| `res`       | μ‘λ‹µ κ°μ²΄. ν΄λΌμ΄μ–ΈνΈμ—κ² μ‘λ‹µμ„ λ³΄λ‚Ό λ• μ‚¬μ© |
| `next()`    | λ‹¤μ λ―Έλ“¤μ›¨μ–΄ ν•¨μλ΅ νλ¦„μ„ μ „λ‹¬. νΈμ¶ν•μ§€ μ•μΌλ©΄ λ‹¤μ λ‹¨κ³„λ΅ μ§„ν–‰λμ§€ μ•μ |
| `res.send()`| μ‘λ‹µμ„ ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅ν•κ³ , μ”μ²­ μ²λ¦¬λ¥Ό μΆ…λ£ν•¨ |

