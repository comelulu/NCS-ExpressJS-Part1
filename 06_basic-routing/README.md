# 06. 라우팅이란? - 서버에 길을 만들어주기

#### 1. **HTTP 메시지란?**

웹 서버는 클라이언트(주로 웹 브라우저)로부터 **HTTP 요청**을 받고, 그에 맞는 **HTTP 응답**을 반환하는 방식으로 동작합니다. 이때 **HTTP 메시지**는 3가지 주요 부분으로 구성됩니다:

- **시작 라인 (Start Line)**:
  - 요청 또는 응답의 첫 번째 줄로, 요청의 **HTTP 메소드**, 요청 경로, 프로토콜 버전 등이 포함됩니다. 예를 들어, `GET /home HTTP/1.1`처럼 요청하는 방식과 경로가 나타납니다.
  
- **헤더 (Headers)**:
  - 요청이나 응답에 대한 **메타데이터**를 포함하는 부분입니다. 예를 들어, 클라이언트가 보낸 **`content-type`**(전송하는 데이터 형식)이나 서버가 보낸 **`status`** 코드(응답 상태) 등이 있습니다.
  
- **본문 (Body)**:
  - 요청이나 응답에서 실제 데이터를 담고 있는 부분입니다. 예를 들어, 클라이언트가 서버에 데이터를 보낼 때는 요청 본문에 포함되고, 서버가 클라이언트에게 HTML 콘텐츠나 JSON 데이터를 보낼 때도 본문에 포함됩니다.

#### 2. **HTTP 요청과 응답 구조 시각화**

- **HTTP 요청** (클라이언트에서 서버로 보내는 요청):
  ```js
  GET /home HTTP/1.1            <- 시작 라인
  Host: localhost:3000          <- 헤더
  Accept: text/html             <- 헤더
  Connection: keep-alive        <- 헤더
  ```

- **HTTP 응답** (서버에서 클라이언트로 보내는 응답):
  ```js
  HTTP/1.1 200 OK               <- 시작 라인
  Content-Type: text/html        <- 헤더
  Content-Length: 1234           <- 헤더
  <html><body><h1>Hello World!</h1></body></html>  <- 본문
  ```

### 3. **라우팅이란 무엇인가요?**

**라우팅(Routing)**은 **서버가 클라이언트의 요청을 처리할 때, 요청 경로(path)와 요청 방식(method)을 기반으로 어떤 작업을 실행할지 결정하는 과정**입니다. 서버는 여러 요청을 받을 수 있고, **각각의 요청에 대해 다른 응답을** 할 수 있도록 **경로와 요청 방식을 매핑(mapping)** 해야 합니다.

- **경로(path)**: 클라이언트가 요청한 URL의 일부분입니다. 예를 들어, `/home`, `/about` 등.
- **요청 방식(method)**: HTTP 요청에서 사용된 **메소드**입니다. 가장 일반적인 메소드로는 **GET**, **POST**, **PUT**, **DELETE** 등이 있습니다.

### 4. **경로(path)와 요청 방식(method)의 매핑**

매핑(mapping)은 **경로와 요청 방식**에 따라 서버가 어떻게 응답할지를 정의하는 것입니다. 예를 들어, `GET /home` 요청을 받으면 **홈 페이지를 반환**하고, `POST /submit` 요청을 받으면 **서버에 데이터를 저장**하는 것과 같은 방식입니다.


| 요청 방식 (Method) | 경로 (Path) | 설명                              | 응답 |
|------------------|------------|---------------------------------|------|
| `GET`            | `/home`    | 홈 페이지 요청                   | HTML 페이지 반환 |
| `POST`           | `/submit`  | 폼 데이터를 서버로 전송          | 성공 메시지 반환 |
| `GET`            | `/about`   | About 페이지 요청                | HTML 페이지 반환 |

---

#### 5. **서버 코드에서 라우팅 구현하기**

이번에는 **Node.js의 http 모듈**을 사용하여 라우팅을 구현하는 예시를 살펴보겠습니다. 이 코드는 **GET /hello** 경로에 대한 요청을 처리하고, 다른 경로에 대해서는 404 에러를 반환하는 간단한 서버입니다.

```javascript
// http 모듈은 NodeJS에 기본 내장되어 있습니다. 이는 별도로 다운로드 없이 바로 사용하시면 됩니다.
const http = require("http");

// http 모듈에는 createServer 메서드가 있습니다.
// 1개의 인자를 사용합니다:
//    - 콜백 함수. 콜백 함수에는 2개의 인자(req, res)가 있습니다.
const server = http.createServer((req, res) => {

  // 요청 URL이 '/hello'인 경우
  if (req.url === '/hello') {
    res.writeHead(200, { "content-type": "text/html" });
    res.write("<h1>Hello World!</h1>");
    res.end();
  } else {
    // '/hello'가 아닌 다른 경로에 대한 요청
    res.writeHead(404, { "content-type": "text/html" });
    res.write("<h1>Sorry, Page Not Found</h1>");
    res.end();
  }
});

// createServer는 listen 메서드가 있는 객체를 반환합니다.
// listen은 2개의 인자를 사용합니다:
// 1. 포트 번호
// 2. 수신이 시작될 경우 호출되는 콜백함수
server.listen(3000, () => {
  console.log("Listening on port 3000");
});
```

### 6. **코드 설명**

1. **`http.createServer`**:
   - 이 메서드는 웹 서버를 만들고, 요청이 들어올 때마다 콜백 함수를 호출합니다. 이 콜백 함수는 클라이언트의 요청을 처리하는 역할을 합니다.
   - `req`는 요청에 대한 정보, `res`는 서버가 응답을 보내는 객체입니다.

2. **`req.url`**:
   - `req.url`은 클라이언트가 요청한 **URL 경로**입니다. 예를 들어, 클라이언트가 `http://localhost:3000/hello`로 요청을 보내면 `req.url`은 `"/hello"`가 됩니다.

3. **라우팅 조건문**:
   - `if (req.url === '/hello')`: 요청된 경로가 `/hello`일 때, **"Hello World!"**라는 메시지를 클라이언트에 보내고 응답을 종료합니다.
   - **그 외의 경로**는 404 페이지를 응답으로 보내고, **"Sorry, Page Not Found"** 메시지를 표시합니다.

4. **`res.writeHead(200, { "content-type": "text/html" })`**:
   - 응답의 상태 코드와 콘텐츠 유형을 설정합니다. `200`은 요청이 성공적으로 처리되었음을 의미하며, `"content-type": "text/html"`은 응답 콘텐츠가 HTML 형식임을 나타냅니다.

5. **`res.write("<h1>Hello World!</h1>")`**:
   - 클라이언트로 보낼 데이터를 작성합니다. `Hello World!`라는 텍스트를 `h1` 태그 안에 넣어 클라이언트에게 전송합니다.

6. **`res.end()`**:
   - 응답을 종료합니다. 클라이언트에게 데이터를 다 보낸 후 응답을 종료하고 요청을 마칩니다.

7. **`server.listen(3000, () => { ... })`**:
   - 서버가 3000번 포트에서 클라이언트의 요청을 기다리도록 설정합니다. 서버가 정상적으로 실행되면 **"Listening on port 3000"** 메시지를 출력합니다.

---

#### 7. **서버 실행과 요청 테스트**

1. **서버 실행**:
   - 터미널에서 `node server.js` 명령어를 입력하여 서버를 실행합니다.

2. **웹 브라우저에서 테스트**:
   - `http://localhost:3000/hello`를 브라우저에서 열면, **"Hello World!"**라는 메시지가 표시됩니다.
   - `http://localhost:3000/any-other-path`로 접속하면, **"Sorry, Page Not Found"**라는 404 에러 페이지가 표시됩니다.

---

#### 8. **서버 실행 흐름**

1. **서버 실행**:
   - `node server.js` 명령어로 서버를 실행하고, 3000번 포트에서 요청을 기다립니다.
   
2. **요청 수신**:
   - 클라이언트가 `http://localhost:3000/hello`를 입력하면, 서버는 `req.url`이 `/hello`인지 확인하고, "Hello World!" 메시지를 반환합니다.
   
3. **404 에러 처리**:
   - 다른 경로로 요청이 들어오면, 서버는 `404` 상태 코드와 함께 "Sorry, Page Not Found" 메시지를 반환합니다.

---

### 9. **최종 정리**

- **라우팅**은 서버가 클라이언트의 요청을 처리할 경로와 방식을 정의하는 중요한 기능입니다.
  - **`req.url`**: 클라이언트가 요청한 경로를 나타냅니다.
  - **조건문**을 사용하여 각 경로에 대한 요청을 처리합니다.
  - **응답 처리**: `res.writeHead`, `res.write`, `res.end`를 통해 클라이언트에게 데이터를 전송합니다.

- **HTTP 요청 처리 흐름**:
  - 클라이언트의 요청 URL과 요청 방식(method)에 따라 적절한 **응답을 반환**하는 방식으로 **서버를 설계**합니다.
